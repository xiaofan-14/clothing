datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        String   @id @default(cuid()) // 用户唯一 ID，自增
  name      String // 用户名 / 昵称
  phone     String   @unique // 手机号
  password  String // 登录密码（加密存储）
  role      String   @default("customer") // 用户角色（customer/admin）
  createdAt DateTime @default(now()) // 创建时间
  updatedAt DateTime @updatedAt // 更新时间

  // 关系
  cart      Cart? // 用户购物车（一个用户一个购物车）
  orders    Order[] // 用户下的所有订单
  favorites Favorite[] // 用户收藏的商品
}

model Category {
  id       String    @id @default(cuid()) // 分类 ID
  name     String // 分类名称（如 T恤、裤子）
  desc     String? // 分类描述（可选）
  products Product[] // 分类下的所有商品
}

model Product {
  id          String   @id @default(cuid()) // 商品 ID
  name        String // 商品名称
  description String? // 商品描述
  price       Float // 商品价格
  stock       Int      @default(0) // 库存数量
  image       String? // 商品图片 URL
  createdAt   DateTime @default(now()) // 上架时间

  categoryId String? // 分类 ID
  category   Category? @relation(fields: [categoryId], references: [id]) // 所属分类

  cartItems  CartItem[] // 购物车项
  orderItems OrderItem[] // 订单项
  favorites  Favorite[] // 收藏记录
}

model Cart {
  id     String     @id @default(cuid()) // 购物车 ID
  userId String     @unique // 用户 ID（唯一，一个用户一个购物车）
  user   User       @relation(fields: [userId], references: [id]) // 关联用户
  items  CartItem[] // 购物车里的商品项
}

model CartItem {
  id       String @id @default(cuid()) // 购物车项 ID
  quantity Int    @default(1) // 商品数量

  cartId String // 所属购物车 ID
  cart   Cart   @relation(fields: [cartId], references: [id]) // 关联购物车

  productId String // 商品 ID
  product   Product @relation(fields: [productId], references: [id]) // 关联商品
}

model Order {
  id        String   @id @default(cuid()) // 订单 ID
  total     Float // 订单总金额
  status    String   @default("paid") // 订单状态（pending/paid/shipped/completed/cancelled）
  createdAt DateTime @default(now()) // 下单时间

  userId String // 用户 ID
  user   User   @relation(fields: [userId], references: [id]) // 下单用户

  items OrderItem[] // 订单包含的商品项
}

model OrderItem {
  id       String @id @default(cuid()) // 订单项 ID
  quantity Int // 购买数量
  price    Float // 商品单价（下单时的价格快照）

  orderId String // 所属订单 ID
  order   Order  @relation(fields: [orderId], references: [id]) // 关联订单

  productId String // 商品 ID
  product   Product @relation(fields: [productId], references: [id]) // 关联商品
}

model Favorite {
  id String @id @default(cuid()) // 收藏记录 ID

  userId String // 用户 ID
  user   User   @relation(fields: [userId], references: [id]) // 关联用户

  productId String // 商品 ID
  product   Product @relation(fields: [productId], references: [id]) // 关联商品
}
